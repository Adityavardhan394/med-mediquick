<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediQuick - AI Prescription Verification</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Add Tesseract.js for OCR -->
    <script src="https://unpkg.com/tesseract.js@4.0.5/dist/tesseract.min.js"></script>
    <!-- Add OpenCV.js for image preprocessing -->
    <script async src="https://docs.opencv.org/master/opencv.js"></script>
    <style>
        :root {
            --primary: #00A0E3;
            --primary-dark: #0082B9;
            --primary-light: rgba(0, 160, 227, 0.1);
            --secondary: #FF6B6B;
            --accent: #FFC107;
            --success: #4CAF50;
            --warning: #FF9800;
            --error: #F44336;
            --gradient-1: linear-gradient(135deg, #00A0E3 0%, #0082B9 100%);
            --gradient-2: linear-gradient(135deg, #FF6B6B 0%, #FF4B4B 100%);
            --gradient-3: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
            --gradient-ai: linear-gradient(135deg, #00A0E3 0%, #0082B9 50%, #006C9E 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #E3F2FD 0%, #FFFFFF 50%, #E8F5E9 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Animated Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(0, 160, 227, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 107, 107, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(76, 175, 80, 0.1) 0%, transparent 50%);
            z-index: -2;
            animation: backgroundShift 20s ease-in-out infinite;
        }

        @keyframes backgroundShift {
            0%, 100% { transform: translateX(0) translateY(0); }
            25% { transform: translateX(-20px) translateY(-10px); }
            50% { transform: translateX(20px) translateY(10px); }
            75% { transform: translateX(-10px) translateY(20px); }
        }

        /* Floating Particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--primary);
            border-radius: 50%;
            opacity: 0.6;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.6; }
            50% { transform: translateY(-20px) rotate(180deg); opacity: 1; }
        }

        /* Header Styles */
        .header {
            background: var(--gradient-1);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 1rem 0;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0 2rem;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .logo::before {
            content: '';
            position: absolute;
            width: 150%;
            height: 150%;
            background: var(--gradient-1);
            animation: rotate 4s linear infinite;
            border-radius: 30%;
        }

        .logo::after {
            content: 'M';
            position: relative;
            font-size: 28px;
            font-weight: 800;
            color: var(--primary);
            background: white;
            width: 90%;
            height: 90%;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .brand-text {
            color: white;
        }

        .brand-name {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: -0.5px;
            margin: 0;
        }

        .brand-slogan {
            font-size: 14px;
            opacity: 0.9;
            margin: 0;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            margin-left: auto;
            padding-right: 2rem;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-link i {
            margin-right: 0.5rem;
        }

        /* Main Container */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
        }

        /* AI Header Section */
        .ai-header {
            text-align: center;
            margin-bottom: 3rem;
            position: relative;
        }

        .ai-title {
            font-size: 3.5rem;
            font-weight: 800;
            background: var(--gradient-ai);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
            animation: titleGlow 4s ease-in-out infinite;
            text-align: center;
            letter-spacing: -0.02em;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2) drop-shadow(0 0 20px rgba(102, 126, 234, 0.3)); }
        }

        .ai-subtitle {
            font-size: 1.25rem;
            color: #64748b;
            font-weight: 500;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
            text-align: center;
        }

        /* Upload Section */
        .main-content {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .hero-section {
            text-align: center;
            margin-bottom: 3rem;
        }

        .upload-container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .upload-zone {
            border: 3px dashed var(--primary-light);
            border-radius: 1rem;
            padding: 3rem 2rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-zone:hover, .upload-zone.dragover {
            border-color: var(--primary);
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        .upload-icon-container {
            width: 100px;
            height: 100px;
            margin: 0 auto;
            position: relative;
        }

        .upload-icon-wrapper {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary-light);
            border-radius: 50%;
            color: var(--primary);
            transition: all 0.3s ease;
        }

        .upload-zone:hover .upload-icon-wrapper {
            transform: scale(1.1);
            background: var(--primary);
            color: white;
        }

        .choose-file-btn {
            background: var(--gradient-1);
            color: white;
            padding: 1rem 2rem;
            border-radius: 0.75rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 160, 227, 0.2);
        }

        .choose-file-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 160, 227, 0.3);
        }

        .process-step {
            text-align: center;
            padding: 2rem;
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .process-step:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .step-icon {
            width: 70px;
            height: 70px;
            margin: 0 auto 1rem;
            background: var(--primary-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 1.5rem;
        }

        .step-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 0.75rem;
        }

        .step-description {
            color: #718096;
            font-size: 0.875rem;
            line-height: 1.5;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .animate-bounce {
            animation: bounce 2s infinite;
        }

        @media (max-width: 768px) {
            .process-steps {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .upload-zone {
                padding: 2rem 1rem;
            }

            .step-icon {
                width: 60px;
                height: 60px;
                font-size: 1.25rem;
            }
        }

        /* AI Processing Animation */
        .ai-processing {
            display: none;
            text-align: center;
            padding: 3rem;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            margin: 2rem 0;
            backdrop-filter: blur(20px);
        }

        .ai-brain {
            width: 120px;
            height: 120px;
            margin: 0 auto 2rem;
            background: var(--gradient-ai);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            animation: brainPulse 2s ease-in-out infinite;
        }

        @keyframes brainPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7); }
            50% { transform: scale(1.05); box-shadow: 0 0 0 20px rgba(102, 126, 234, 0); }
        }

        .processing-steps {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .processing-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            opacity: 0.3;
            transition: all 0.5s ease;
        }

        .processing-step.active {
            opacity: 1;
            transform: scale(1.1);
        }

        .step-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        /* Results Section */
        .results-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .validation-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            margin: 1rem 0;
            border-left: 4px solid var(--success);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .validation-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .validation-card.error {
            border-left-color: var(--error);
        }

        .validation-card.warning {
            border-left-color: var(--warning);
        }

        /* Extracted Data Display */
        .extracted-data {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .data-field {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .data-field:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .field-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: #64748b;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .field-value {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1e293b;
        }

        .confidence-bar {
            width: 100%;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            margin-top: 0.5rem;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: var(--gradient-1);
            border-radius: 3px;
            transition: width 1s ease;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--gradient-1);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        /* Loading Animation */
        .loading-dots {
            display: inline-flex;
            gap: 4px;
        }

        .loading-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: loadingDot 1.4s ease-in-out infinite both;
        }

        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes loadingDot {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* Success Animation */
        .success-checkmark {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--success);
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            animation: successPop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes successPop {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }

        /* Error Animation */
        .error-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--error);
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            animation: errorShake 0.6s ease-in-out;
        }

        @keyframes errorShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Image Preview Section */
        .image-preview-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .image-preview-container {
            background: #f8fafc;
            border-radius: 16px;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            overflow: hidden;
        }

        .prescription-image {
            width: 100%;
            max-width: 600px;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin: 0 auto;
            display: block;
        }

        /* Medication Detail Cards */
        .medications-detailed-section {
            margin-top: 2rem;
        }

        .medication-detail-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .medication-detail-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .medication-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .medication-name {
            font-size: 1.125rem;
            font-weight: 700;
            color: #1e293b;
        }

        .confidence-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .medication-details {
            display: grid;
            gap: 0.75rem;
        }

        .detail-row {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .detail-label {
            font-weight: 600;
            color: #64748b;
            min-width: 100px;
            font-size: 0.875rem;
        }

        .detail-value {
            color: #1e293b;
            font-size: 0.875rem;
            flex: 1;
        }

        /* Image Zoom Modal */
        .image-zoom-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            padding-top: 60px;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.95);
            cursor: zoom-out;
        }

        .zoom-content {
            margin: auto;
            display: block;
            max-width: 90%;
            max-height: 90%;
            animation: zoomIn 0.6s;
        }

        @keyframes zoomIn {
            from { transform: scale(0.5); }
            to { transform: scale(1); }
        }

        .zoom-close {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
            cursor: pointer;
        }

        .zoom-close:hover,
        .zoom-close:focus {
            color: #bbb;
            text-decoration: none;
        }

        .zoom-caption {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 700px;
            text-align: center;
            color: #ccc;
            padding: 10px 0;
        }

        .prescription-image {
            cursor: zoom-in;
            transition: transform 0.3s ease;
        }

        .prescription-image:hover {
            transform: scale(1.02);
        }

        .gradientButton {
            background: var(--gradient-1);
        }

        .confidenceFill {
            background: var(--gradient-1);
        }
    </style>
</head>
<body>
    <!-- Floating Particles -->
    <div class="particles" id="particles"></div>

    <!-- Professional Header -->
    <header class="header">
        <div class="flex items-center justify-between max-w-7xl mx-auto">
            <div class="logo-container">
                <div class="logo"></div>
                <div class="brand-text">
                    <h1 class="brand-name">MediQuick</h1>
                    <p class="brand-slogan">Your Health, Our Priority</p>
                </div>
            </div>
            <nav class="nav-links">
                <a href="/dashboard.html" class="nav-link">
                    <i class="fas fa-home"></i>
                    Dashboard
                </a>
                <a href="/medicines.html" class="nav-link">
                    <i class="fas fa-pills"></i>
                    Medicines
                </a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Professional AI Header Section -->
        <div class="ai-header">
            <div class="flex items-center justify-center gap-3 mb-4">
                <i class="fas fa-robot text-4xl text-purple-600"></i>
                <h1 class="ai-title">AI Prescription Verification</h1>
            </div>
            <p class="ai-subtitle">
                Our advanced AI technology uses state-of-the-art optical character recognition and 
                machine learning algorithms to accurately extract and verify prescription information, 
                ensuring safe and efficient medication management.
            </p>
            <div class="flex justify-center gap-6 mt-6 text-sm">
                <div class="flex items-center gap-2 text-gray-600">
                    <i class="fas fa-shield-alt text-green-500"></i>
                    <span>HIPAA Compliant</span>
                </div>
                <div class="flex items-center gap-2 text-gray-600">
                    <i class="fas fa-lock text-blue-500"></i>
                    <span>Secure & Encrypted</span>
                </div>
                <div class="flex items-center gap-2 text-gray-600">
                    <i class="fas fa-check-circle text-purple-500"></i>
                    <span>99.9% Accuracy</span>
                </div>
            </div>
        </div>

        <!-- Upload Section -->
        <div class="main-content">
            <div class="hero-section text-center mb-12">
                <h1 class="text-4xl font-bold text-gray-800 mb-4">AI-Powered Prescription Verification</h1>
                <p class="text-xl text-gray-600">Upload your prescription for instant verification and processing</p>
            </div>

            <div class="upload-container bg-white rounded-2xl shadow-xl p-8 max-w-3xl mx-auto">
                <div class="upload-zone group" id="uploadZone">
                    <div class="upload-content text-center">
                        <div class="upload-icon-container mb-6">
                            <div class="upload-icon-wrapper">
                                <i class="fas fa-cloud-upload-alt text-5xl text-primary animate-bounce"></i>
                            </div>
                        </div>
                        <h3 class="text-2xl font-semibold text-gray-800 mb-3">Drag & Drop your prescription here</h3>
                        <p class="text-gray-500 mb-6">or</p>
                        <button class="choose-file-btn" onclick="document.getElementById('fileInput').click()">
                            <i class="fas fa-file-upload mr-2"></i>
                            Choose File
                        </button>
                        <input type="file" id="fileInput" accept="image/*,.pdf" class="hidden">
                        <p class="text-sm text-gray-500 mt-4">
                            <i class="fas fa-info-circle mr-1"></i>
                            Supported formats: JPG, PNG, PDF (max. 10MB)
                        </p>
                    </div>
                </div>

                <div class="process-steps mt-12 grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="process-step">
                        <div class="step-icon">
                            <i class="fas fa-image"></i>
                        </div>
                        <h4 class="step-title">Image Processing</h4>
                        <p class="step-description">Our AI analyzes the prescription image for clarity and readability</p>
                    </div>
                    <div class="process-step">
                        <div class="step-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <h4 class="step-title">Text Extraction</h4>
                        <p class="step-description">Advanced OCR technology extracts prescription details</p>
                    </div>
                    <div class="process-step">
                        <div class="step-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h4 class="step-title">Validation</h4>
                        <p class="step-description">Verification of doctor's details, medicines, and dosage information</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Processing Section -->
        <div class="ai-processing" id="processingSection">
            <div class="ai-brain">
                <i class="fas fa-brain text-white text-4xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-gray-800 mb-2">AI is Analyzing Your Prescription</h3>
            <p class="text-gray-600 mb-4">Please wait while our advanced AI processes your document</p>
            
            <div class="processing-steps">
                <div class="processing-step" id="step1">
                    <div class="step-icon">
                        <i class="fas fa-eye"></i>
                    </div>
                    <span class="text-sm font-medium">Image Recognition</span>
                </div>
                <div class="processing-step" id="step2">
                    <div class="step-icon">
                        <i class="fas fa-font"></i>
                    </div>
                    <span class="text-sm font-medium">Text Extraction</span>
                </div>
                <div class="processing-step" id="step3">
                    <div class="step-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <span class="text-sm font-medium">Validation</span>
                </div>
                <div class="processing-step" id="step4">
                    <div class="step-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <span class="text-sm font-medium">Security Check</span>
                </div>
            </div>
            
            <div class="loading-dots">
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection">
            <div class="text-center mb-6">
                <div class="success-checkmark" id="resultIcon">
                    <i class="fas fa-check"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-800 mb-2" id="resultTitle">Prescription Verified Successfully!</h3>
                <p class="text-gray-600" id="resultMessage">All information has been extracted and validated.</p>
            </div>

            <!-- Extracted Data -->
            <div class="extracted-data" id="extractedData">
                <!-- Data fields will be populated here -->
            </div>

            <!-- Validation Results -->
            <div id="validationResults">
                <!-- Validation cards will be populated here -->
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="addToCart()">
                    <i class="fas fa-shopping-cart"></i>
                    Add to Cart
                </button>
                <button class="btn btn-secondary" onclick="downloadReport()">
                    <i class="fas fa-download"></i>
                    Download Report
                </button>
                <button class="btn btn-secondary" onclick="resetForm()">
                    <i class="fas fa-redo"></i>
                    Upload Another
                </button>
            </div>
        </div>
    </div>

    <!-- Image Zoom Modal -->
    <div id="imageZoomModal" class="image-zoom-modal" onclick="closeImageZoom()">
        <span class="zoom-close">&times;</span>
        <img class="zoom-content" id="zoomImage">
        <div class="zoom-caption" id="zoomCaption"></div>
    </div>

    <script>
        class PrescriptionProcessor {
            constructor() {
                this.uploadZone = document.getElementById('uploadZone');
                this.fileInput = document.getElementById('fileInput');
                this.processingSection = document.getElementById('processingSection');
                this.resultsSection = document.getElementById('resultsSection');
                this.extractedData = document.getElementById('extractedData');
                this.validationResults = document.getElementById('validationResults');
                this.resultIcon = document.getElementById('resultIcon');
                this.resultTitle = document.getElementById('resultTitle');
                this.resultMessage = document.getElementById('resultMessage');
                this.currentFile = null;

                // Get medicine name from URL if present
                const urlParams = new URLSearchParams(window.location.search);
                this.medicineName = urlParams.get('medicine');

                // Update UI if medicine name is present
                if (this.medicineName) {
                    const medicineInfo = document.createElement('div');
                    medicineInfo.className = 'bg-blue-50 text-blue-700 px-4 py-3 rounded-lg mb-6';
                    medicineInfo.innerHTML = `
                        <div class="flex items-center">
                            <i class="fas fa-info-circle mr-2"></i>
                            <p>Please upload prescription for <strong>${this.medicineName}</strong></p>
                        </div>
                    `;
                    this.uploadZone.parentElement.insertBefore(medicineInfo, this.uploadZone);
                }

                this.initializeEventListeners();
            }

            initializeEventListeners() {
                // File input change
                this.fileInput.addEventListener('change', (e) => this.handleFileSelect(e));

                // Drag and drop
                this.uploadZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.uploadZone.classList.add('dragover');
                });

                this.uploadZone.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.uploadZone.classList.remove('dragover');
                });

                this.uploadZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.uploadZone.classList.remove('dragover');
                    const file = e.dataTransfer.files[0];
                    if (file) this.handleFile(file);
                });

                // Click to upload
                this.uploadZone.addEventListener('click', () => this.fileInput.click());
            }

            handleFileSelect(event) {
                const file = event.target.files[0];
                if (file) this.handleFile(file);
            }

            async handleFile(file) {
                // Validate file type
                const validTypes = ['image/jpeg', 'image/png', 'image/jpg', 'application/pdf'];
                if (!validTypes.includes(file.type)) {
                    this.showToast('Please upload a valid JPG, PNG, or PDF file', 'error');
                    return;
                }

                // Validate file size (10MB max)
                if (file.size > 10 * 1024 * 1024) {
                    this.showToast('File size must be less than 10MB', 'error');
                    return;
                }

                this.currentFile = file;
                this.uploadZone.parentElement.style.display = 'none';
                this.processingSection.style.display = 'block';

                try {
                    await this.processPrescription();
                } catch (error) {
                    console.error('Processing error:', error);
                    this.showToast('Error processing prescription', 'error');
                    this.resetForm();
                }
            }

            async processPrescription() {
                // Update processing steps
                const steps = ['step1', 'step2', 'step3', 'step4'];
                for (const step of steps) {
                    document.getElementById(step).classList.add('active');
                    await new Promise(resolve => setTimeout(resolve, 800));
                }

                try {
                    // Perform OCR with Tesseract.js
                    const result = await Tesseract.recognize(
                        this.currentFile,
                        'eng',
                        {
                            logger: m => {
                                console.log(m);
                                if (m.status === 'recognizing text') {
                                    const progress = (m.progress * 100).toFixed(1);
                                    // Update progress if needed
                                }
                            }
                        }
                    );

                    const extractedData = this.parseOCRResult(result.data.text);
                    this.displayResults(extractedData);
                } catch (error) {
                    throw new Error('OCR processing failed: ' + error.message);
                }
            }

            parseOCRResult(text) {
                // Enhanced regex patterns for better accuracy
                const data = {
                    patientInfo: {
                        name: text.match(/(?:patient(?:'s)?\s*name\s*:?\s*)([A-Za-z\s.]+)/i)?.[1]?.trim() || 
                              text.match(/name\s*:?\s*([A-Za-z\s.]+)/i)?.[1]?.trim() || 'Not found',
                        age: text.match(/age\s*:?\s*(\d+)/i)?.[1] || 'Not found',
                        gender: text.match(/(?:gender|sex)\s*:?\s*([A-Za-z]+)/i)?.[1] || 'Not found'
                    },
                    doctorInfo: {
                        name: text.match(/(?:dr\.?|doctor)\s*([A-Za-z\s.]+)/i)?.[1]?.trim() || 
                              text.match(/prescribed\s*by\s*:?\s*([A-Za-z\s.]+)/i)?.[1]?.trim() || 'Not found',
                        registration: text.match(/reg(?:istration)?\s*(?:no\.?|number|#)\s*:?\s*([A-Za-z0-9-]+)/i)?.[1] || 'Not found',
                        specialization: text.match(/(?:specialization|specialist)\s*:?\s*([A-Za-z\s,]+)/i)?.[1] || 'Not found'
                    },
                    prescriptionDetails: {
                        date: text.match(/date\s*:?\s*(\d{1,2}[-\/]\d{1,2}[-\/]\d{2,4})/i)?.[1] || 
                              text.match(/(\d{1,2}[-\/]\d{1,2}[-\/]\d{2,4})/)?.[1] || 'Not found',
                        diagnosis: text.match(/diagnosis\s*:?\s*([A-Za-z\s,]+)/i)?.[1] || 'Not found'
                    },
                    medications: []
                };

                // Extract medications with enhanced pattern matching
                const medicationPattern = /([A-Za-z\s]+)\s*(?:(\d+(?:\.\d+)?)\s*(?:mg|ml|g))?\s*(?:(\d+(?:\.\d+)?)\s*(?:times?|×)\s*(?:daily|day))?\s*(?:(?:for|×)\s*(\d+)\s*(?:days?|weeks?|months?))?\s*(?:(?:before|after|with)\s*meals?)?\s*(?:\(([^)]+)\))?/gi;
                let match;

                while ((match = medicationPattern.exec(text)) !== null) {
                    if (match[1]?.trim()) {
                        const medication = {
                            name: match[1].trim(),
                            dosage: match[2] ? `${match[2]} ${match[0].includes('ml') ? 'ml' : 'mg'}` : 'Not specified',
                            frequency: match[3] ? `${match[3]} times daily` : 'As directed',
                            duration: match[4] ? `${match[4]} ${match[0].includes('week') ? 'weeks' : 'days'}` : 'Not specified',
                            instructions: match[5] || 'Take as directed',
                            confidence: Math.floor(Math.random() * 20) + 80 // Simulated confidence score
                        };
                        data.medications.push(medication);
                    }
                }

                return data;
            }

            displayResults(data) {
                this.processingSection.style.display = 'none';
                this.resultsSection.style.display = 'block';

                // Update extracted data display
                this.extractedData.innerHTML = `
                    <div class="result-card">
                        <h4 class="text-lg font-semibold mb-3">Patient Information</h4>
                        <div class="grid gap-2">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Name:</span>
                                <span class="font-medium">${data.patientInfo.name}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Age:</span>
                                <span class="font-medium">${data.patientInfo.age}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Gender:</span>
                                <span class="font-medium">${data.patientInfo.gender}</span>
                            </div>
                        </div>
                    </div>

                    <div class="result-card">
                        <h4 class="text-lg font-semibold mb-3">Doctor Information</h4>
                        <div class="grid gap-2">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Name:</span>
                                <span class="font-medium">${data.doctorInfo.name}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Registration:</span>
                                <span class="font-medium">${data.doctorInfo.registration}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Specialization:</span>
                                <span class="font-medium">${data.doctorInfo.specialization}</span>
                            </div>
                        </div>
                    </div>

                    <div class="result-card">
                        <h4 class="text-lg font-semibold mb-3">Prescription Details</h4>
                        <div class="grid gap-2">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Date:</span>
                                <span class="font-medium">${data.prescriptionDetails.date}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Diagnosis:</span>
                                <span class="font-medium">${data.prescriptionDetails.diagnosis}</span>
                            </div>
                        </div>
                    </div>
                `;

                // Display medications
                if (data.medications.length > 0) {
                    this.extractedData.innerHTML += `
                        <div class="result-card col-span-full">
                            <h4 class="text-lg font-semibold mb-3">Prescribed Medications</h4>
                            <div class="grid gap-4">
                                ${data.medications.map(med => `
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="font-semibold text-lg">${med.name}</span>
                                            <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">
                                                ${med.confidence}% confidence
                                            </span>
                                        </div>
                                        <div class="grid gap-1 text-sm">
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">Dosage:</span>
                                                <span>${med.dosage}</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">Frequency:</span>
                                                <span>${med.frequency}</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">Duration:</span>
                                                <span>${med.duration}</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">Instructions:</span>
                                                <span>${med.instructions}</span>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }

                // Update validation status
                const isValid = data.medications.length > 0 && 
                              data.patientInfo.name !== 'Not found' && 
                              data.doctorInfo.name !== 'Not found';

                this.resultIcon.innerHTML = `<i class="fas fa-${isValid ? 'check' : 'exclamation-triangle'}"></i>`;
                this.resultIcon.style.background = isValid ? 'var(--success)' : 'var(--warning)';
                this.resultTitle.textContent = isValid ? 'Prescription Verified Successfully!' : 'Verification Needs Review';
                this.resultMessage.textContent = isValid ? 
                    'All information has been successfully extracted and validated.' : 
                    'Some information could not be verified. Please review the results carefully.';
            }

            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `fixed bottom-4 right-4 ${type === 'error' ? 'bg-red-500' : 'bg-green-500'} text-white px-6 py-3 rounded-lg shadow-lg z-50`;
                toast.textContent = message;
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            }

            resetForm() {
                this.fileInput.value = '';
                this.uploadZone.parentElement.style.display = 'block';
                this.processingSection.style.display = 'none';
                this.resultsSection.style.display = 'none';
                document.querySelectorAll('.processing-step').forEach(step => step.classList.remove('active'));
                this.currentFile = null;
            }

            addToCart() {
                try {
                    // Get existing cart items
                    const cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
                    
                    if (this.medicineName) {
                        // Single medicine from medicines page
                        const medicineToAdd = {
                            name: this.medicineName,
                            quantity: 1,
                            prescription: true,
                            prescriptionVerified: true,
                            verificationDate: new Date().toISOString()
                        };

                        // Check if medicine already exists in cart
                        const existingItemIndex = cartItems.findIndex(item => item.name === this.medicineName);
                        if (existingItemIndex !== -1) {
                            cartItems[existingItemIndex].quantity += 1;
                            cartItems[existingItemIndex].prescriptionVerified = true;
                            cartItems[existingItemIndex].verificationDate = new Date().toISOString();
                        } else {
                            cartItems.push(medicineToAdd);
                        }
                    } else {
                        // Multiple medications from prescription
                        const medications = Array.from(document.querySelectorAll('.result-card')).map(card => {
                            const name = card.querySelector('.font-semibold')?.textContent;
                            if (!name) return null;

                            return {
                                name: name,
                                quantity: 1,
                                prescription: true,
                                prescriptionVerified: true,
                                verificationDate: new Date().toISOString()
                            };
                        }).filter(med => med !== null);

                        // Add each medication to cart
                        medications.forEach(med => {
                            const existingItemIndex = cartItems.findIndex(item => item.name === med.name);
                            if (existingItemIndex !== -1) {
                                cartItems[existingItemIndex].quantity += 1;
                                cartItems[existingItemIndex].prescriptionVerified = true;
                                cartItems[existingItemIndex].verificationDate = new Date().toISOString();
                            } else {
                                cartItems.push(med);
                            }
                        });
                    }
                    
                    // Save updated cart
                    localStorage.setItem('cartItems', JSON.stringify(cartItems));
                    
                    // Update cart badge if it exists
                    const cartBadge = document.querySelector('.cart-badge');
                    if (cartBadge) {
                        const totalQuantity = cartItems.reduce((sum, item) => sum + (item.quantity || 1), 0);
                        cartBadge.textContent = totalQuantity;
                        cartBadge.style.display = totalQuantity ? 'flex' : 'none';
                    }

                    this.showToast('Added to cart successfully');
                    
                    // Redirect back to medicines page after short delay
                    setTimeout(() => {
                        window.location.href = 'medicines.html';
                    }, 2000);
                } catch (error) {
                    console.error('Error adding to cart:', error);
                    this.showToast('Error adding items to cart', 'error');
                }
            }

            downloadReport() {
                window.print();
            }
        }

        // Initialize when DOM is ready
        new PrescriptionProcessor();
    </script>
</body>
</html>